<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Zen Final</title>
    <style>
        :root {
            --gradient-1: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-2: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --gradient-3: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft YaHei", sans-serif;
            color: white;
            transition: background 1s ease;
            /* é˜²æ­¢IOSç‚¹å‡»é—ªçƒ */
            -webkit-tap-highlight-color: transparent;
        }

        /* ä¸»é¢˜é…è‰² */
        body.theme-morning { background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
        body.theme-ocean { background: linear-gradient(to top, #30cfd0 0%, #330867 100%); }
        body.theme-aurora { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); }
        body.theme-dusk { background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%); }
        body.theme-forest { background: linear-gradient(to top, #0ba360 0%, #3cba92 100%); }

        body::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEUAAAA5OTkAAAAAAAAAAABMTExERERmZmZnMy3EAAAACHRSTlMAM8zMzMzMzMwI4V7fAAAASUlEQVQ4y2NgwA04mYC8MysFwYwMIE4G4q5ZKQh3zUpBuGsw7prlgnDXLBeEu2a5INw1ywXhrlkuCHfNcgG5i5kYyF3MxFy4CwA61woE+Q2H1gAAAABJRU5ErkJggg==');
            opacity: 0.05; pointer-events: none; z-index: -1;
        }

        .score-board {
            font-size: 18px; margin-bottom: 15px; /* ç¨å¾®ç¼©å‡é—´è· */
            letter-spacing: 1px; font-weight: 300;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2); z-index: 10;
        }
        .highlight { font-weight: 600; font-size: 1.3em; margin: 0 6px; }

        .controls {
            display: flex; gap: 8px; margin-bottom: 20px; z-index: 10;
            flex-wrap: wrap; justify-content: center;
        }

        select, button {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white; padding: 8px 12px;
            border-radius: 20px; font-size: 13px; /* å­—ä½“æ”¹å°ä¸€ç‚¹ç‚¹é€‚åº”æ‰‹æœº */
            cursor: pointer; backdrop-filter: blur(5px);
            outline: none; transition: all 0.2s;
        }
        button:hover, select:hover { transform: scale(1.05); background: rgba(255, 255, 255, 0.4); }

        /* --- ğŸ“± æ ¸å¿ƒä¿®å¤åŒºåŸŸï¼šæ£‹ç›˜å®¹å™¨ --- */
        .game-board {
            display: grid;
            /* æ™ºèƒ½é—´è·ï¼šæ‰‹æœºä¸Š4pxï¼Œç”µè„‘ä¸Š12px -> å®Œç¾è§£å†³æ‰‹æœºæŒ¤çˆ†é—®é¢˜ */
            gap: clamp(4px, 1.5vw, 12px); 
            padding: clamp(10px, 2vw, 20px);
            
            /* é™åˆ¶æœ€å¤§å®½åº¦ï¼šè®©5x4åœ¨ç”µè„‘ä¸Šä¹Ÿä¸ä¼šå¤ªé«˜ */
            width: 92vw;          /* ç•™å‡ºå·¦å³è¾¹è· */
            max-width: 460px;     /* æ”¶ç´§æœ€å¤§å®½åº¦ */
            
            /* å±…ä¸­æœºåˆ¶ */
            margin: 0 auto;
            
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            z-index: 10;
            box-sizing: border-box; /* ç¡®ä¿paddingä¸ç®—åœ¨å®½åº¦é‡Œ */
        }

        /* --- ğŸƒ å¡ç‰‡æ ·å¼ --- */
        .card {
            background-color: transparent;
            border-radius: 8px; /* åœ†è§’æ”¹å°ï¼Œé€‚åº”å¯†é›†ç½‘æ ¼ */
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            
            /* å¼ºåˆ¶æ­£æ–¹å½¢ */
            width: 100%;
            aspect-ratio: 1/1; 
            /* ç§»é™¤æ‰€æœ‰å¯¼è‡´æ’‘å¤§çš„æœ€å°å®½åº¦é™åˆ¶ */
            min-width: 0; 
        }

        .card.flip { transform: rotateY(180deg); }
        .card.hidden { opacity: 0; pointer-events: none; transform: scale(0.8); transition: opacity 0.5s, transform 0.5s; }

        .front, .back {
            width: 100%; height: 100%;
            position: absolute;
            border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            
            /* --- ğŸ”  å­—ä½“æ™ºèƒ½ç¼©æ”¾ --- */
            /* æ‰‹æœºä¸Š(6x6)å­—ä½“ä¼šè‡ªåŠ¨å˜å°ï¼Œä¸ä¼šæ’‘ç ´æ ¼å­ */
            font-size: clamp(18px, 6vw, 32px);
            
            backface-visibility: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            /* ç¦æ­¢ç”¨æˆ·é€‰ä¸­emojiï¼Œé˜²æ­¢æ‰‹æœºä¸Šå‡ºç°è“è‰²é€‰æ¡† */
            user-select: none; 
        }

        .back { 
            background: rgba(44, 62, 80, 0.7); 
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.3);
            backdrop-filter: blur(5px);
        }

        .front { transform: rotateY(180deg); color: #444; font-weight: bold; }
        .front.color-type-1 { background: var(--gradient-1); }
        .front.color-type-2 { background: var(--gradient-2); }
        .front.color-type-3 { background: var(--gradient-3); }

    </style>
</head>
<body class="theme-morning">

    <div class="score-board">
        <span id="txt-steps">æ­¥æ•°</span> <span id="current-moves" class="highlight">0</span> 
        <span style="opacity: 0.5; margin: 0 10px;">|</span>
        <span id="txt-best">æœ€ä½³</span> <span id="best-score" class="highlight">--</span>
    </div>

    <div class="controls">
        <select id="difficulty"></select>
        <button onclick="initGame()" id="btn-restart">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button onclick="toggleLanguage()" class="lang-btn">ğŸŒ ä¸­/En</button>
    </div>

    <div class="game-board" id="board"></div>

    <script>
        const themes = ['theme-morning', 'theme-ocean', 'theme-aurora', 'theme-dusk', 'theme-forest'];

        const translations = {
            zh: {
                steps: "æ­¥æ•°", best: "æœ€ä½³", restart: "ğŸ”„ é‡æ–°å¼€å§‹",
                winTitle: "æ­å–œé€šå…³ï¼", winMsg: "æ€»å…±æ­¥æ•°ï¼š",
                options: [
                    { val: "4x3", text: "ç®€å• (4x3)" },
                    { val: "4x4", text: "æ ‡å‡† (4x4)" },
                    { val: "5x4", text: "è¿›é˜¶ (5x4)" },
                    { val: "6x6", text: "æé™ (6x6)" }
                ]
            },
            en: {
                steps: "Steps", best: "Best", restart: "ğŸ”„ Restart",
                winTitle: "You Won!", winMsg: "Total moves: ",
                options: [
                    { val: "4x3", text: "Easy (4x3)" },
                    { val: "4x4", text: "Medium (4x4)" },
                    { val: "5x4", text: "Hard (5x4)" },
                    { val: "6x6", text: "Zen (6x6)" }
                ]
            }
        };

        let currentLang = 'zh'; 
        const allEmojis = [
            'ğŸŒ¿', 'ğŸ‚', 'ğŸ„', 'ğŸŒµ', 'ğŸŒ´', 'ğŸŒ¸', 'ğŸŒ»', 'ğŸ',
            'ğŸ”ï¸', 'ğŸŒŠ', 'ğŸŒ™', 'â­', 'â˜ï¸', 'â„ï¸', 'ğŸ”¥', 'ğŸ’§',
            'ğŸ“·', 'âŒš', 'ğŸ§', 'â˜•', 'ğŸ»', 'ğŸ¹', 'ğŸ¨', 'ğŸš²',
            'ğŸ¦Š', 'ğŸ¦Œ', 'ğŸ‹', 'ğŸ•Šï¸', 'ğŸ¦¢', 'ğŸ¦‹', 'ğŸ', 'ğŸ'
        ];

        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let moves = 0;
        let matchesFound = 0;
        let totalPairs = 0;
        
        const board = document.getElementById('board');
        const difficultySelect = document.getElementById('difficulty');
        const movesDisplay = document.getElementById('current-moves');
        const bestScoreDisplay = document.getElementById('best-score');
        
        difficultySelect.addEventListener('change', initGame);

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateUIText();
        }

        function updateUIText() {
            const t = translations[currentLang];
            document.getElementById('txt-steps').innerText = t.steps;
            document.getElementById('txt-best').innerText = t.best;
            document.getElementById('btn-restart').innerText = t.restart;
            const currentVal = difficultySelect.value || "4x4"; 
            difficultySelect.innerHTML = "";
            t.options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.val;
                option.innerText = opt.text;
                if (opt.val === currentVal) option.selected = true;
                difficultySelect.appendChild(option);
            });
        }

        function initGame() {
            document.body.classList.remove(...themes);
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            document.body.classList.add(randomTheme);

            moves = 0;
            matchesFound = 0;
            hasFlippedCard = false;
            lockBoard = false;
            firstCard = null;
            secondCard = null;
            movesDisplay.innerText = moves;
            board.innerHTML = ''; 

            const mode = difficultySelect.value; 
            const [rows, cols] = mode.split('x').map(Number);
            totalPairs = (rows * cols) / 2;
            
            loadBestScore(mode);

            // --- ğŸ”§ ä¿®å¤æ ¸å¿ƒï¼šç½‘æ ¼å¸ƒå±€ ---
            // ä½¿ç”¨ 1fr å¹³åˆ†ç©ºé—´ï¼Œç¡®ä¿ä¸æº¢å‡º
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            allEmojis.sort(() => 0.5 - Math.random());
            let selectedEmojis = allEmojis.slice(0, totalPairs);

            let preparedCards = selectedEmojis.map(emoji => {
                const randomColorNum = Math.floor(Math.random() * 3) + 1;
                return {
                    icon: emoji,
                    colorClass: `color-type-${randomColorNum}`
                };
            });

            let gameDeck = [...preparedCards, ...preparedCards];
            gameDeck.sort(() => 0.5 - Math.random());

            gameDeck.forEach(cardData => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.icon = cardData.icon; 
                
                card.innerHTML = `
                    <div class="front ${cardData.colorClass}">${cardData.icon}</div>
                    <div class="back"></div>
                `;
                card.addEventListener('click', flipCard);
                board.appendChild(card);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;
            this.classList.add('flip');
            if (!hasFlippedCard) {
                hasFlippedCard = true; firstCard = this; return;
            }
            secondCard = this; updateMoves(); checkForMatch();
        }

        function updateMoves() {
            moves++; movesDisplay.innerText = moves;
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            lockBoard = true; matchesFound++;
            setTimeout(() => {
                firstCard.classList.add('hidden'); secondCard.classList.add('hidden');
                resetBoard();
                if (matchesFound === totalPairs) handleWin();
            }, 700);
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flip'); secondCard.classList.remove('flip');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        function handleWin() {
            setTimeout(() => {
                const mode = difficultySelect.value;
                const currentBest = localStorage.getItem(`memory_zen_v62_best_${mode}`);
                const t = translations[currentLang];
                alert(`${t.winTitle}\n${t.winMsg}${moves}`);
                if (!currentBest || moves < parseInt(currentBest)) {
                    localStorage.setItem(`memory_zen_v62_best_${mode}`, moves);
                    bestScoreDisplay.innerText = moves;
                }
            }, 600);
        }

        function loadBestScore(mode) {
            const best = localStorage.getItem(`memory_zen_v62_best_${mode}`);
            bestScoreDisplay.innerText = best ? best : '--';
        }

        updateUIText();
        initGame();
    </script>
</body>
</html>