<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Zen Final</title>
    <style>
        :root {
            --gradient-1: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-2: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --gradient-3: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft YaHei", sans-serif;
            color: white;
            transition: background 1s ease;
            -webkit-tap-highlight-color: transparent;
        }

        /* ‰∏ªÈ¢òÈÖçËâ≤ */
        body.theme-morning { background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
        body.theme-ocean { background: linear-gradient(to top, #30cfd0 0%, #330867 100%); }
        body.theme-aurora { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); }
        body.theme-dusk { background: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%); }
        body.theme-forest { background: linear-gradient(to top, #0ba360 0%, #3cba92 100%); }

        body::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEUAAAA5OTkAAAAAAAAAAABMTExERERmZmZnMy3EAAAACHRSTlMAM8zMzMzMzMwI4V7fAAAASUlEQVQ4y2NgwA04mYC8MysFwYwMIE4G4q5ZKQh3zUpBuGsw7prlgnDXLBeEu2a5INw1ywXhrlkuCHfNcgG5i5kYyF3MxFy4CwA61woE+Q2H1gAAAABJRU5ErkJggg==');
            opacity: 0.05; pointer-events: none; z-index: -1;
        }

        .score-board {
            font-size: 18px; margin-bottom: 15px;
            letter-spacing: 1px; font-weight: 300;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2); z-index: 10;
        }
        .highlight { font-weight: 600; font-size: 1.3em; margin: 0 6px; }

        .controls {
            display: flex; gap: 8px; margin-bottom: 20px; z-index: 10;
            flex-wrap: wrap; justify-content: center;
        }

        select, button {
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white; padding: 8px 12px;
            border-radius: 20px; font-size: 13px;
            cursor: pointer; backdrop-filter: blur(5px);
            outline: none; transition: all 0.2s;
        }
        button:hover, select:hover { transform: scale(1.05); background: rgba(255, 255, 255, 0.4); }

        .game-board {
            display: grid;
            gap: clamp(4px, 1.5vw, 12px); 
            padding: clamp(10px, 2vw, 20px);
            width: 92vw; max-width: 460px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            z-index: 10;
            box-sizing: border-box;
        }

        .card {
            background-color: transparent;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            width: 100%; aspect-ratio: 1/1; 
            min-width: 0; 
        }

        .card.flip { transform: rotateY(180deg); }
        .card.hidden { opacity: 0; pointer-events: none; transform: scale(0.8); transition: opacity 0.5s, transform 0.5s; }

        .front, .back {
            width: 100%; height: 100%;
            position: absolute;
            border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            font-size: clamp(18px, 6vw, 32px);
            backface-visibility: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            user-select: none; 
        }

        .back { 
            background: rgba(255, 255, 255, 0.35); 
            
            border: 1px solid rgba(255, 255, 255, 0.6);
            
            backdrop-filter: blur(5px);
            
            color: rgba(255, 255, 255, 0.8);
        }

        .front { transform: rotateY(180deg); color: #444; font-weight: bold; }
        .front.color-type-1 { background: var(--gradient-1); }
        .front.color-type-2 { background: var(--gradient-2); }
        .front.color-type-3 { background: var(--gradient-3); }

        /* ÂºπÁ™óÊ†∑Âºè */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active { opacity: 1; pointer-events: auto; }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            color: #333;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-title { font-size: 26px; font-weight: bold; margin-bottom: 10px; color: #2d3436; }
        .modal-text { font-size: 18px; margin-bottom: 25px; color: #636e72; }
        
        .modal-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            border: none; padding: 12px 35px;
            border-radius: 50px; font-size: 16px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .modal-btn:hover { 
            transform: scale(1.05);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
        }

    </style>
</head>
<body class="theme-morning">

    <div class="score-board">
        <span id="txt-steps">Ê≠•Êï∞</span> <span id="current-moves" class="highlight">0</span> 
        <span style="opacity: 0.5; margin: 0 10px;">|</span>
        <span id="txt-best">ÊúÄ‰Ω≥</span> <span id="best-score" class="highlight">--</span>
    </div>

    <div class="controls">
        <select id="difficulty"></select>
        <button onclick="initGame()" id="btn-restart">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
        <button onclick="toggleLanguage()" class="lang-btn">üåê ‰∏≠/En</button>
    </div>

    <div class="game-board" id="board"></div>

    <div class="modal-overlay" id="win-modal">
        <div class="modal-content">
            <div class="modal-title" id="modal-title">üéâ ÊÅ≠ÂñúÈÄöÂÖ≥!</div>
            <div class="modal-text" id="modal-msg">ÊÄªÂÖ±Ê≠•Êï∞: 0</div>
            <button class="modal-btn" onclick="closeModalAndRestart()" id="modal-btn">ÂÜçÊù•‰∏ÄÂ±Ä</button>
        </div>
    </div>

    <script>
        const themes = ['theme-morning', 'theme-ocean', 'theme-aurora', 'theme-dusk', 'theme-forest'];

        const translations = {
            zh: {
                steps: "Ê≠•Êï∞", best: "ÊúÄ‰Ω≥", restart: "üîÑ ÈáçÊñ∞ÂºÄÂßã",
                winTitle: "üéâ ÊÅ≠ÂñúÈÄöÂÖ≥!", winMsg: "ÊÄªÂÖ±Ê≠•Êï∞Ôºö",
                playAgain: "ÂÜçÊù•‰∏ÄÂ±Ä",
                options: [
                    { val: "4x3", text: "ÁÆÄÂçï (4x3)" },
                    { val: "4x4", text: "Ê†áÂáÜ (4x4)" },
                    { val: "5x4", text: "ËøõÈò∂ (5x4)" },
                    { val: "6x6", text: "ÊûÅÈôê (6x6)" }
                ]
            },
            en: {
                steps: "Steps", best: "Best", restart: "üîÑ Restart",
                winTitle: "üéâ You Won!", winMsg: "Total moves: ",
                playAgain: "Play Again",
                options: [
                    { val: "4x3", text: "Easy (4x3)" },
                    { val: "4x4", text: "Medium (4x4)" },
                    { val: "5x4", text: "Hard (5x4)" },
                    { val: "6x6", text: "Zen (6x6)" }
                ]
            }
        };

        let currentLang = 'zh'; 
        const allEmojis = [
            'üåø', 'üçÇ', 'üçÑ', 'üåµ', 'üå¥', 'üå∏', 'üåª', 'üçÅ',
            'üèîÔ∏è', 'üåä', 'üåô', '‚≠ê', '‚òÅÔ∏è', '‚ùÑÔ∏è', 'üî•', 'üíß',
            'üì∑', '‚åö', 'üéß', '‚òï', 'üéª', 'üéπ', 'üé®', 'üö≤',
            'ü¶ä', 'ü¶å', 'üêã', 'üïäÔ∏è', 'ü¶¢', 'ü¶ã', 'üêû', 'üêù'
        ];

        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let moves = 0;
        let matchesFound = 0;
        let totalPairs = 0;
        
        const board = document.getElementById('board');
        const difficultySelect = document.getElementById('difficulty');
        const movesDisplay = document.getElementById('current-moves');
        const bestScoreDisplay = document.getElementById('best-score');
        
        const winModal = document.getElementById('win-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMsg = document.getElementById('modal-msg');
        const modalBtn = document.getElementById('modal-btn');
        
        difficultySelect.addEventListener('change', initGame);

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateUIText();
        }

        function updateUIText() {
            const t = translations[currentLang];
            document.getElementById('txt-steps').innerText = t.steps;
            document.getElementById('txt-best').innerText = t.best;
            document.getElementById('btn-restart').innerText = t.restart;
            modalBtn.innerText = t.playAgain;
            const currentVal = difficultySelect.value || "4x4"; 
            difficultySelect.innerHTML = "";
            t.options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.val;
                option.innerText = opt.text;
                if (opt.val === currentVal) option.selected = true;
                difficultySelect.appendChild(option);
            });
        }

        function initGame() {
            winModal.classList.remove('active');
            document.body.classList.remove(...themes);
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            document.body.classList.add(randomTheme);

            moves = 0; matchesFound = 0; hasFlippedCard = false; lockBoard = false;
            firstCard = null; secondCard = null;
            movesDisplay.innerText = moves; board.innerHTML = ''; 

            const mode = difficultySelect.value; 
            const [rows, cols] = mode.split('x').map(Number);
            totalPairs = (rows * cols) / 2;
            loadBestScore(mode);
            board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            allEmojis.sort(() => 0.5 - Math.random());
            let selectedEmojis = allEmojis.slice(0, totalPairs);
            let preparedCards = selectedEmojis.map(emoji => {
                const randomColorNum = Math.floor(Math.random() * 3) + 1;
                return { icon: emoji, colorClass: `color-type-${randomColorNum}` };
            });
            let gameDeck = [...preparedCards, ...preparedCards];
            gameDeck.sort(() => 0.5 - Math.random());

            gameDeck.forEach(cardData => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.icon = cardData.icon; 
                card.innerHTML = `<div class="front ${cardData.colorClass}">${cardData.icon}</div><div class="back"></div>`;
                card.addEventListener('click', flipCard);
                board.appendChild(card);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;
            this.classList.add('flip');
            if (!hasFlippedCard) { hasFlippedCard = true; firstCard = this; return; }
            secondCard = this; updateMoves(); checkForMatch();
        }

        function updateMoves() { moves++; movesDisplay.innerText = moves; }

        function checkForMatch() {
            let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            lockBoard = true; matchesFound++;
            setTimeout(() => {
                firstCard.classList.add('hidden'); secondCard.classList.add('hidden');
                resetBoard();
                if (matchesFound === totalPairs) handleWin();
            }, 700);
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flip'); secondCard.classList.remove('flip');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        function handleWin() {
            setTimeout(() => {
                const mode = difficultySelect.value;
                const currentBest = localStorage.getItem(`memory_zen_v67_best_${mode}`);
                const t = translations[currentLang];
                if (!currentBest || moves < parseInt(currentBest)) {
                    localStorage.setItem(`memory_zen_v67_best_${mode}`, moves);
                    bestScoreDisplay.innerText = moves;
                }
                modalTitle.innerText = t.winTitle;
                modalMsg.innerText = `${t.winMsg}${moves}`;
                winModal.classList.add('active');
            }, 600);
        }

        function closeModalAndRestart() {
            winModal.classList.remove('active');
            setTimeout(initGame, 300);
        }

        function loadBestScore(mode) {
            const best = localStorage.getItem(`memory_zen_v67_best_${mode}`);
            bestScoreDisplay.innerText = best ? best : '--';
        }

        updateUIText();
        initGame();
    </script>
</body>
</html>
